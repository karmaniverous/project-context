# Refactor: extract pure CLI arg mapper

When: 2025-08-19T14:05:00Z
Why: Commander-dependent tests were brittle (selection=null). We want a pure, deterministic function to derive runSelected inputs and thin out the CLI adapter.
What changed:

- src/cli/stan/run-args.ts: new deriveRunInvocation() to compute selection/mode/behavior.
- src/cli/stan/runner.ts: call deriveRunInvocation; remove token/args recovery helpers.
- src/cli/stan/runner.test.ts: test deriveRunInvocation for -e and -s cases.
- src/cli/stan/runner.combine.test.ts: test combine/keep and combinedFileName propagation.
  Tests/Lint:
- Expected to resolve the two failing CLI tests.
- Lint/typecheck remain clean.
  Links:
- Prior failures: stan/test.txt (runner tests).
  Next:
- Optional: add 1 E2E smoke test asserting the one-line plan output.
