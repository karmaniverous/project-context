# Refactor: parse/resolver (strip candidates + diagnostics)

When: 2025-08-22T01:30:00Z (UTC)
Why: Advance P0 patch robustness by parsing unified diffs to derive strip candidates (p1 vs p0) and emitting basic per-file diagnostics for FEEDBACK. This supports deterministic retry order and clearer failure analysis.

What changed:
- src/stan/patch/parse.ts: new module with parseUnifiedDiff() and diagnosePatch().
- src/stan/patch/index.ts: uses parseUnifiedDiff() to choose stripCandidates; FEEDBACK now includes diagnostics (top 10 files).
- src/stan/patch/parse.test.ts: unit tests covering AB-prefix detection, strip order, and diagnostics.

Tests/Lint:
- All existing tests remain passing; new parser tests added.
- Lint/typecheck/docs are clean.

Next:
- Extend resolver to classify path mismatches vs context drift using repo FS (optional).
- Consider optional DMP fallback engine after jsdiff.
